<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Giftcard & Crypto P2P </title>
    <link rel="stylesheet" href="style.css">
  </head>

  
  <body>
    <header>
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h2>Giftcard wave</h2>
        </div>

        <ul class="menu">
          <a href="giftcard.html" class="active"><li><i class="icon">üè†</i> <span>Dashboard</span></li> </a>
          <a href="wallet.html"><li><i class="icon">üëõ</i> <span>Wallet</span></li></a>
          <a href="transactions.html"><li><i class="icon">üßæ</i> <span>Transactions</span></li></a>
          <a href="rewards.html"><li><i class="icon">üéÅ</i> <span>Rewards</span></li></a>
          <a href="leaderboard.html"><li><i class="icon">üèÜ</i> <span>Leaderboard</span></li></a>
          <a href="rate-calculator.html"><li><i class="icon">üßÆ</i> <span>Rate Calculator</span></li></a>
          <a href="favourites.html"><li><i class="icon">‚≠ê</i> <span>Favourite</span></li></a>
          <a href="rate-target.html"><li><i class="icon">üéØ</i> <span>Rate Target</span></li></a>
          <a href="show-love.html"><li><i class="icon">‚ù§Ô∏è</i> <span>Show Love</span></li></a>  
        </ul>
      </div>

      <!-- MOBILE MENU BUTTON -->
      <div class="menu-btn" id="menuBtn">
    <!-- DASHBOARD PAGE -->
     <div id=" dashboard" class="page">
     <hi> dashboard</hi>
     <div class="card"> Balance: NGN 0</div>
     <div class="card full"><h3>Recent Activity</h3> No Activity</div>
</div>
       <!-- WALLET PAGE -->
    <div id="wallet" class="page hidden">
        <h1>Wallet</h1>
        <div class="card">
            <h3>Available Balances</h3>
            NGN: 0<br>BTC: 0.00<br>USDT: 0.00
        </div>
      
<div class="main-content">
    <h1>Transactions</h1>

    <div class="card full">
        <h3>All Transactions</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="4">No transactions yet.</td></tr>
            </tbody>
        </table>
    </div>
</div>
    
<div class="main-content">
    <h1>Rewards</h1>

    <div class="card">
        <h3>Your Reward Level</h3>
        <p>Level: 0 ‚≠ê</p>
        <p>No rewards earned yet.</p>
    </div>
</div>

<div class="main-content">
    <h1>Leaderboard</h1>

    <div class="card full">
        <table class="table">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Trades</th>
                    <th>Volume</th>
                </tr>
            </thead>
            <tbody>
                <tr><td colspan="3">No ranks available.</td></tr>
            </tbody>
        </table>
    </div>
</div>
 
 <div class="main-content">
    <h1>Rate Calculator</h1>

    <div class="card">
        <label>Amount (USD)</label>
        <input type="number" class="input" placeholder="Enter card value">

        <label>Brand</label>
        <select class="input">
            <option>Amazon</option>
            <option>Steam</option>
            <option>iTunes</option>
        </select>

        <button class="btn">Calculate</button>

        <p class="result">Result: ‚Ç¶0</p>
    </div>
</div>

 <div class="main-content">
    <h1>Favourite Listings</h1>

    <div class="card">
        <p>You have no favourite listings yet.</p>
    </div>
</div>

 <div class="main-content">
    <h1>Rate Target</h1>

    <div class="card">
        <label>Desired Selling Rate</label>
        <input type="number" class="input" placeholder="‚Ç¶ per USD">

        <button class="btn">Save Target</button>
    </div>
</div>

<div class="main-content">
    <h1>Show Love ‚ù§Ô∏è</h1>

    <div class="card">
        <p>If you enjoy the platform, show love by sharing ‚ù§Ô∏è</p>
        <button class="btn">Share</button>
    </div>
</div>

        <button class="btn">Top Up</button>
        <button class="btn">Withdraw</button>
    </div>
      
    </header>
    
    <main class="main-content">
      <div class="grid">
        <aside class="card">
          <div class="wallet row">
            <div>
              <label class="muted">Current User</label>
              <div class="row">
                <strong id="username">You</strong>
                <div class="muted" style="margin-left: 8px">(Real account)</div>
              </div>
            </div>
          </div>
          <hr style="margin: 12px 0; border-color: rgba(255, 255, 255, 0.03)" />

          <div>
            <label class="muted">Balances</label>
            <div class="row" style="justify-content: space-between">
              <div class="balance">
                <div class="small">NGN <strong id="balance-ng">0</strong></div>
              </div>
              <div class="balance">
                <div class="small">BTC <strong id="balance-btc">0</strong></div>
              </div>
              <div class="balance">
                <div class="small">
                  USDT <strong id="balance-usdt">0</strong>
                </div>
              </div>
            </div>
          </div>

          <hr style="margin: 12px 0; border-color: rgba(255, 255, 255, 0.03)" />

          <div>
            <label class="muted">Create listing</label>
            <form id="createForm">
              <label class="muted">Type</label>
              <select id="listing-type">
                <option value="giftcard">Gift Card</option>
                <option value="crypto">Crypto</option>
              </select>

              <label class="muted">Asset (e.g. Amazon $50 or BTC)</label>
              <input
                id="listing-asset"
                placeholder="e.g. Google Play $25 / BTC"
                required
              />

              <label class="muted">Amount / Quantity</label>
              <input
                id="listing-qty"
                type="number"
                min="1"
                value="1"
                required
              />

              <label class="muted">Price (in NGN) or price per unit</label>
              <input
                id="listing-price"
                type="number"
                min="0"
                step="0.01"
                value="1000"
                required
              />

              <label class="muted">Payment method</label>
              <input
                id="listing-payment"
                placeholder="Bank Transfer, PayPal, Crypto wallet"
              />

              <label class="muted">Description</label>
              <textarea
                id="listing-desc"
                rows="3"
                placeholder="Short description or terms"
              ></textarea>

              <div style="margin-top: 10px; display: flex; gap: 8px">
                <button type="submit">Create</button>
                <button
                  type="button"
                  id="fund-btn"
                  style="
                    background: transparent;
                    border: 1px solid rgba(255, 255, 255, 0.06);
                    color: var(--muted);
                  "
                >
                  Add funds
                </button>
              </div>
            </form>
          </div>
        </aside>

        <section>
          <div class="card">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
              "
            >
              <div>
                <div class="muted">Marketplace</div>
                <h2 style="margin: 4px 0">Active Listings</h2>
              </div>
              <div style="display: flex; gap: 8px; align-items: center">
                <input
                  id="search"
                  placeholder="Search asset or payment"
                  style="
                    padding: 8px;
                    border-radius: 8px;
                    border: 1px solid rgba(255, 255, 255, 0.26);
                    background: var(--glass);
                  "
                />
                <select
                  id="filter-type"
                  style="
                    padding: 8px;
                    border-radius: 8px;
                    background: var(--glass);
                  "
                >
                  <option value="all">All</option>
                  <option value="giftcard">Gift Card</option>
                  <option value="crypto">Crypto</option>
                </select>
              </div>
            </div>

            <div id="listings" class="listings"></div>
          </div>

          <div class="card" style="margin-top: 12px">
            <h3>Recent Escrows</h3>
            <div id="escrows" class="muted small">No escrows yet</div>
          </div>
        </section>
      </div>

      <footer>Giftcard, crypto P2P marketplace ‚Äî &copy; 2025</footer>
    </main>
    <!-- Modal: Buy / Escrow -->
    <div id="modal" class="modal-backdrop">
      <div class="modal">
        <h3 id="modal-title">Place Order</h3>
        <div id="modal-body"></div>\\
        <div class="actions" style="margin-top: 12px">
          <button
            id="modal-close"
            style="
              background: transparent;
              color: var(--muted);
              border: 1px solid rgba(255, 255, 255, 0.04);
            "
          >
            Close
          </button>
          <button id="modal-confirm" class="success">Confirm</button>
        </div>
      </div>
    </div>
    <script>
        const menuBtn = document.getElementById("menuBtn");
const sidebar = document.getElementById("sidebar");

menuBtn.onclick = () => {
  sidebar.classList.toggle("show");
};

      // Simple demo P2P marketplace ‚Äî client-side only.
      const LS_KEYS = {
        LISTINGS: "p2p_listings_v1",
        ESCROWS: "p2p_escrows_v1",
        USER: "p2p_user_v1",
      };

      // Demo user
      let user = JSON.parse(localStorage.getItem(LS_KEYS.USER) || "null") || {
        id: "user_me",
        name: "You",
        balances: { NGN: 0, BTC: 0.0, USDT: 0 },
      };
      localStorage.setItem(LS_KEYS.USER, JSON.stringify(user));

      // UI refs
      const el = (id) => document.getElementById(id);
      const listingsEl = el("listings");
      const escrowsEl = el("escrows");
      const balanceNG = el("balance-ng");
      const balanceBTC = el("balance-btc");
      const balanceUSDT = el("balance-usdt");

      function loadListings() {
        return JSON.parse(localStorage.getItem(LS_KEYS.LISTINGS) || "[]");
      }
      function saveListings(l) {
        localStorage.setItem(LS_KEYS.LISTINGS, JSON.stringify(l));
      }
      function loadEscrows() {
        return JSON.parse(localStorage.getItem(LS_KEYS.ESCROWS) || "[]");
      }
      function saveEscrows(e) {
        localStorage.setItem(LS_KEYS.ESCROWS, JSON.stringify(e));
      }

      function refreshBalances() {
        balanceNG.textContent = Number(user.balances.NGN).toLocaleString();
        balanceBTC.textContent = Number(user.balances.BTC);
        balanceUSDT.textContent = Number(user.balances.USDT);
      }

      function renderListings() {
        const all = loadListings();
        const q = el("search").value.toLowerCase();
        const typeFilter = el("filter-type").value;
        let filtered = all.filter(
          (l) =>
            (typeFilter === "all" || l.type === typeFilter) &&
            (l.asset.toLowerCase().includes(q) ||
              (l.payment || "").toLowerCase().includes(q) ||
              (l.desc || "").toLowerCase().includes(q))
        );
        listingsEl.innerHTML = "";
        if (!filtered.length)
          listingsEl.innerHTML = '<div class="muted">No listings found.</div>';
        filtered.forEach((l) => {
          const node = document.createElement("div");
          node.className = "listing";
          node.innerHTML = `
          <div class="row" style="justify-content:space-between"><div><strong>${escapeHtml(
            l.asset
          )}</strong></div><div class="pill">${l.type}</div></div>
          <div class="meta">Price: NGN ${Number(
            l.price
          ).toLocaleString()} ‚Ä¢ Qty: ${l.qty}</div>
          <div class="meta">Seller: <span class="muted">${escapeHtml(
            l.sellerName || "seller"
          )}</span></div>
          <div style="margin-top:8px;font-size:13px">${escapeHtml(
            l.desc || ""
          )}</div>
          <div style="display:flex;gap:8px;margin-top:10px;justify-content:space-between;align-items:center">
            <div class="meta small">Pay: ${escapeHtml(l.payment || "Any")}</div>
            <div style="display:flex;gap:8px">
              <button data-id="${l.id}" class="buy-btn">Buy</button>
              ${
                l.sellerId === user.id
                  ? '<button class="danger" disabled>My listing</button>'
                  : ""
              }
            </div>
          </div>
        `;
          listingsEl.appendChild(node);
        });

        // attach buy listeners
        document
          .querySelectorAll(".buy-btn")
          .forEach((btn) =>
            btn.addEventListener("click", (e) =>
              openBuyModal(e.target.dataset.id)
            )
          );
      }

      function renderEscrows() {
        const esc = loadEscrows();
        if (!esc.length) {
          escrowsEl.textContent = "No escrows yet";
          return;
        }
        escrowsEl.innerHTML = "";
        esc
          .slice()
          .reverse()
          .forEach((s) => {
            const div = document.createElement("div");
            div.className = "row";
            div.style.justifyContent = "space-between";
            div.innerHTML = `<div class="small">${escapeHtml(
              s.asset
            )} ‚Äî NGN ${Number(
              s.amount
            ).toLocaleString()} | <span class="muted">${s.status}</span></div>`;
            const actions = document.createElement("div");
            if (s.sellerId === user.id && s.status === "BUYER_FUNDED") {
              const b = document.createElement("button");
              b.textContent = "Mark as Delivered";
              b.addEventListener("click", () => sellerMarkDelivered(s.id));
              actions.appendChild(b);
            }
            if (s.buyerId === user.id && s.status === "SHIPPED") {
              const b = document.createElement("button");
              b.textContent = "Confirm Received";
              b.addEventListener("click", () => buyerConfirm(s.id));
              actions.appendChild(b);
            }
            div.appendChild(actions);
            escrowsEl.appendChild(div);
          });
      }

      // create listing
      el("createForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const type = el("listing-type").value;
        const asset = el("listing-asset").value.trim();
        const qty = Number(el("listing-qty").value) || 1;
        const price = Number(el("listing-price").value) || 0;
        const payment = el("listing-payment").value.trim();
        const desc = el("listing-desc").value.trim();
        if (!asset || price <= 0)
          return alert("Please provide asset and valid price");
        const listings = loadListings();
        const id = "L" + Date.now() + Math.floor(Math.random() * 999);
        listings.push({
          id,
          type,
          asset,
          qty,
          price,
          payment,
          desc,
          sellerId: user.id,
          sellerName: user.name,
          created: Date.now(),
        });
        saveListings(listings);
        renderListings();
        el("createForm").reset();
      });

      // open buy modal
      function openBuyModal(listingId) {
        const l = loadListings().find((x) => x.id === listingId);
        if (!l) return alert("Listing not found");
        const modal = el("modal");
        modal.style.display = "flex";
        el("modal-title").textContent = "Place Order ‚Äî " + l.asset;
        el("modal-body").innerHTML = `
        <div class="muted">Seller: ${escapeHtml(l.sellerName || "seller")}</div>
        <div style="margin-top:8px">Price per unit: NGN ${Number(
          l.price
        ).toLocaleString()}</div>
        <label class="muted" style="margin-top:8px">Quantity</label>
        <input id="order-qty" type="number" min="1" value="1" />
        <div style="margin-top:8px" class="muted">Total: <strong id="order-total"></strong></div>
      `;
        const qtyInput = el("order-qty");
        const totalEl = el("order-total");
        function updateTotal() {
          const q = Number(qtyInput.value) || 1;
          totalEl.textContent = "NGN " + (q * l.price).toLocaleString();
        }
        qtyInput.addEventListener("input", updateTotal);
        updateTotal();

        el("modal-confirm").onclick = () => {
          const q = Number(qtyInput.value) || 1;
          const total = q * l.price;
          if (user.balances.NGN < total)
            return alert("Insufficient NGN balance. Use Add demo funds.");
          // create escrow
          user.balances.NGN -= total; // move to escrow (deduct from buyer)
          const esc = loadEscrows();
          const escrowId = "E" + Date.now() + Math.floor(Math.random() * 999);
          esc.push({
            id: escrowId,
            listingId: l.id,
            asset: l.asset,
            amount: total,
            qty: q,
            sellerId: l.sellerId,
            buyerId: user.id,
            status: "BUYER_FUNDED",
            created: Date.now(),
          });
          saveEscrows(esc);
          localStorage.setItem(LS_KEYS.USER, JSON.stringify(user));
          refreshBalances();
          renderEscrows();
          modal.style.display = "none";
          alert(
            "Order created and funds moved to escrow. Communicate with seller to complete trade."
          );
        };
      }

      el("modal-close").addEventListener(
        "click",
        () => (el("modal").style.display = "none")
      );

      // seller marks delivered
      function sellerMarkDelivered(escrowId) {
        const esc = loadEscrows();
        const e = esc.find((x) => x.id === escrowId);
        if (!e) return;
        if (e.sellerId !== user.id)
          return alert("Only seller can mark delivered");
        e.status = "SHIPPED";
        saveEscrows(esc);
        renderEscrows();
        alert(
          "Marked as shipped/delivered. Buyer should confirm to release funds."
        );
      }

      // buyer confirms and releases funds to seller
      function buyerConfirm(escrowId) {
        const esc = loadEscrows();
        const e = esc.find((x) => x.id === escrowId);
        if (!e) return;
        if (e.buyerId !== user.id) return alert("Only buyer can confirm");
        // pay seller
        // find seller ‚Äî if it's you (demo) pay to demo seller account in storage
        // for simplicity, if seller is not current user we simulate adding to a 'marketplace' account in localStorage
        const listings = loadListings();
        const listing = listings.find((l) => l.id === e.listingId);
        // credit seller
        if (e.sellerId === user.id) {
          user.balances.NGN += e.amount;
        } else {
          // add to a generic seller pool stored in LS
          const sellers = JSON.parse(
            localStorage.getItem("p2p_demo_sellers") || "{}"
          );
          sellers[e.sellerId] = sellers[e.sellerId] || {
            balances: { NGN: 0, BTC: 0, USDT: 0 },
          };
          sellers[e.sellerId].balances.NGN += e.amount;
          localStorage.setItem("p2p_demo_sellers", JSON.stringify(sellers));
        }
        e.status = "COMPLETED";
        saveEscrows(esc);
        localStorage.setItem(LS_KEYS.USER, JSON.stringify(user));
        refreshBalances();
        renderEscrows();
        alert("Trade completed. Funds released to seller.");
      }

      // helper: add demo funds
      el("fund-btn").addEventListener("click", () => {
        user.balances.NGN += 100000;
        user.balances.USDT += 50;
        user.balances.BTC += 0.05;
        localStorage.setItem(LS_KEYS.USER, JSON.stringify(user));
        refreshBalances();
        alert("Demo funds added");
      });

      // small helpers
      function escapeHtml(s) {
        if (!s) return "";
        return s
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;");
      }

      // initial render
      refreshBalances();
      renderListings();
      renderEscrows();

      // search/filter listeners
      el("search").addEventListener("input", renderListings);
      el("filter-type").addEventListener("change", renderListings);

      // seed with demo listings if none
      (function seed() {
        const all = loadListings();
        if (all.length) return;
        const seedL = [
          {
            id: "L101",
            type: "giftcard",
            asset: "Amazon $50",
            qty: 3,
            price: 21000,
            payment: "Bank Transfer",
            desc: "Genuine Amazon e-giftcard. Instant delivery.",
            sellerId: "seller_1",
            sellerName: "CardKing",
          },
          {
            id: "L102",
            type: "giftcard",
            asset: "Google Play $25",
            qty: 5,
            price: 9000,
            payment: "Bank Transfer",
            desc: "Good for apps & games",
            sellerId: "seller_2",
            sellerName: "CodeCards",
          },
          {
            id: "L103",
            type: "crypto",
            asset: "BTC",
            qty: 0.001,
            price: 2500000,
            payment: "On-chain",
            desc: "Small BTC sell. Fast.",
            sellerId: "seller_3",
            sellerName: "CryptoJoe",
          },
        ];
        saveListings(seedL);
        renderListings();
      })();
    </script>
  </body>
</html>
